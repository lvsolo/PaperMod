---
title: "YOLO Series"
author: "lvsolo"
date: "2024-09-16"
tags: ["DeepLearning", "training", "YOLO"]
---
YOLOv2 对于 YOLOv1 的改进主要包括以下几个方面：

1. **Batch Normalization（批归一化）**：在每个卷积层后添加了批归一化，提高了模型的收敛速度，减少了对其他正则化方法的依赖，提升了模型的泛化能力，使得 mAP 提升了约 2%  。
2. **High Resolution Classifier（高分辨率分类器）**：在 ImageNet 数据集上使用更高分辨率（448x448）的图片进行预训练，使得模型在检测数据集上微调之前已经适应了高分辨率输入，提升了 mAP 约 4%  。
3. **Convolutional With Anchor Boxes（带 Anchor Boxes 的卷积）**：借鉴了 Faster R-CNN 的思想，引入了 Anchor Boxes，使用卷积层预测边界框，提高了目标的定位准确率  。
4. **Dimension Clusters（维度聚类）**：通过 K-means 聚类自动确定 Anchor Boxes 的尺寸，使得模型更容易学习预测好的检测结果  。
5. **Direct location prediction（直接位置预测）**：改进了坐标的预测方式，使得模型在预测时更加直接和准确 。
6. **Fine-Grained Features（细粒度特征）**：引入了 passthrough 层来利用更精细的特征图，有助于检测小物体，提升了模型性能约 1%  。
7. **Multi-Scale Training（多尺度训练）**：在训练过程中，每隔一定的迭代次数后改变模型的输入图片大小，增强了模型对不同尺寸图片的鲁棒性，提升了 mAP  。

这些改进使得 YOLOv2 在保持原有速度优势的同时，显著提高了检测精度。


Yolov8中的“中心点邻近区域 + 动态IoU匹配“

1.中心点邻近区域，进行training gt assignment；缓解微小偏移影响，增强小目标召回

2.动态IoU匹配：

1）top-k

2）动态IoU阈值

3）分类置信度与IoU进行加权打分


它是联合优化正样本分配的策略，旨在更精准地匹配预测框与真实目标的位置关系。以下分步详解其原理：

1. 中心点邻近区域（Central Region）
   1.1 目标中心区域定义
   基础思想：将真实边界框（Ground Truth）的中心点扩展为一个邻近区域，而非仅单个像素点，以缓解网格对齐和特征图下采样的误差。
   区域大小计算：
   根据真实框的宽高动态调整邻近区域范围。
   公式：区域半径 r=γ×(w×h)/N，其中：
   w,h 为真实框的宽和高。
   N 为图像中该真实框对应的特征图单元总数（与下采样倍数相关）。
   γ 为超参数（默认0.5），控制区域扩展程度。
   1.2 邻近区域作用
   候选正样本选择：
   在特征图上，若预测框中心的投影坐标落在真实框的中心邻近区域内，则被视为候选正样本。
   示例：真实框在640x640图像中的中心为(320, 320)，对应80x80特征图（下采样8倍）的(40,40)位置，扩展邻近区域半径 r=2，则候选区域覆盖索引（38,38）到（42,42）的网格。
   1.3 优势
   缓解微小偏移敏感：允许预测框中心在真实中心附近一定范围内浮动。
   增强小目标召回：对于小目标，邻近区域相对覆盖更广，避免单一网格对应的位置偏差。
   2. 动态IoU匹配（Dynamic IoU Assignment）
   2.1 动态匹配机制
   候选池筛选：首先通过中心邻近区域筛选出候选正样本（通常为多个预测框）。
   动态IoU排序：
   计算候选预测框与真实框的IoU值。
   根据IoU值由高到低排序，保留Top-K预测框（K根据复杂度自动调整）。
   设定动态IoU阈值（如≥0.5），选择最终正样本。
   2.2 动态阈值调整
   理论依据：每个真实框的匹配条件应适配其自身难易程度。
   AdaMatch策略：
   统计候选池中Top-M个预测框的IoU均值 μ 和标准差 σ。
   动态阈值 T=μ+ασ，仅选择IoU≥T的预测框为正样本。
   其中 α 为超参数（默认1.25），控制筛选严格度。
   2.3 多任务均衡
   分类与回归联合优化：
   任务对齐（Task Alignment）：引入分类置信度与IoU的加权得分 S=Clsβ×IoU1−β，平衡分类与定位精度（β为调节因子，默认0.5）。
   得分排序：根据 S 对候选预测框重新排序，确保高分样本兼顾定位和分类准确性。
   3. 详细流程示例
   以检测单张图像中的一个目标为例：

输入：真实框坐标 (xgt,ygt,wgt,hgt)，对应特征图分辨率80x80。
中心邻近区域计算：
特征图单元步长 s=8，真实中心对应网格坐标 (xg,yg)=(⌊xgt/s⌋,⌊ygt/s⌋)。
区域半径 r=0.5×(wgt×hgt)/(802)×s。
候选框选择：
在特征图上的 [xg−r,xg+r]×[yg−r,yg+r] 区域内，选出所有预测框。
动态IoU匹配：
计算候选框IoU，取Top-K的10%数量（如K=50）。
动态阈值筛选后保留IoU≥0.6的预测框。
任务对齐分配：
最终根据 S=Cls×IoU 选择最高得分的3个预测框作为正样本。
4. 性能优化分析
4.1 对比传统策略
指标	YOLOv5（静态锚框匹配）	YOLOv8（动态IoU匹配）
正样本数量	固定每真实框3~9锚框	动态调整（平均1~5）
样本质量	依赖预定义锚框	基于实际预测性能动态筛选
小目标适应力	易漏检（锚框覆盖有限）	邻近区域扩展覆盖更广
4.2 COCO数据集效果
AP提升：动态分配策略使YOLOv8的AP_S（小目标AP）相比YOLOv5提高2%~3%。
收敛速度：训练迭代次数减少20%（因正样本更精准）。
5. 实际应用建议
参数调优：
扩展半径因子 γ：对小目标检测可调至0.6，增大候选范围。
动态阈值系数 α：遮挡较多场景降低至1.0，宽松筛选。
可视化验证：
可视化训练时的正样本分布，观察是否覆盖目标敏感区域。
硬件适配：
动态匹配虽增加计算，但通过CUDA并行优化对推理速度影响<5%。
总结
YOLOv8的"中心点邻近区域 + 动态IoU匹配"策略通过扩展正样本候选范围，并结合预测质量动态筛选，显著提升了目标检测的鲁棒性和定位精度，尤其在复杂场景和小目标检测中表现突出。此设计反映了目标检测领域向更灵活、任务自适应的样本分配发展的趋势。
